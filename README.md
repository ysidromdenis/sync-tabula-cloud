# Tabula Cloud Sync

**Librer√≠a reutilizable para sincronizaci√≥n con Tabula Cloud API**

[![Python Version](https://img.shields.io/badge/python-3.7+-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)](CHANGELOG.md)

> **üöÄ Nueva versi√≥n librer√≠a**: Ahora `tabula-cloud-sync` es una librer√≠a reutilizable con auto-configuraci√≥n, CLI integrado y templates personalizables.

## üåü Caracter√≠sticas

- **Auto-configuraci√≥n**: Se configura autom√°ticamente al instalar/importar
- **Templates personalizables**: Genera c√≥digo base para servicios personalizados
- **Soporte multi-BD**: Compatible con PostgreSQL, MySQL, SQL Server, SQLite
- **CLI integrado**: Herramientas de l√≠nea de comandos para gesti√≥n de proyectos
- **Build tools autom√°ticos**: Construcci√≥n y configuraci√≥n autom√°tica
- **Logging avanzado**: Sistema de logging configurable y robusto
- **Compatibilidad multiplataforma**: Windows, Linux, macOS
- **Daemon support**: Ejecuci√≥n como servicio/daemon del sistema

## üì¶ Instalaci√≥n

### Instalaci√≥n b√°sica

```bash
pip install tabula-cloud-sync
```

### Instalaci√≥n con soporte para bases de datos

```bash
pip install tabula-cloud-sync[database]
```

### Instalaci√≥n para desarrollo

```bash
pip install tabula-cloud-sync[dev]
```

## üîß Uso R√°pido

### 1. Auto-configuraci√≥n

```python
# Solo importar - se auto-configura autom√°ticamente
from tabula_cloud_sync import TabulaCloudService
```

### 2. Crear servicio personalizado

```python
from tabula_cloud_sync import TabulaCloudService

class MiServicio(TabulaCloudService):
    def perform_sync(self):
        # Tu l√≥gica de sincronizaci√≥n aqu√≠
        return {'status': 'success', 'records': 100}

# Ejecutar
servicio = MiServicio()
servicio.start()
```

### 3. CLI - Inicializar proyecto

```bash
tabula-cli init --project-name "MiEmpresa"
```

---

## üìã Documentaci√≥n anterior

> La siguiente documentaci√≥n corresponde a la versi√≥n anterior como template/servicio standalone.
> cp config.ini.template config.ini
> nano config.ini # Editar configuraci√≥n

# 4. Instalar como servicio

sudo ./tabula-cloud-sync install --config config.ini # Linux/macOS

# o

tabula-cloud-sync.exe install --config config.ini # Windows (como Admin)

````

### Opci√≥n 2: Desde C√≥digo Fuente (Desarrolladores)

```bash
# Clonar repositorio
git clone https://github.com/ysidromdenis/template-sync-tabula-cloud.git
cd template-sync-tabula-cloud

# Instalar en modo desarrollo
pip install -e .

# Para Windows (soporte completo de servicios)
pip install -e .[windows]
````

### Opci√≥n 3: Como Dependencia

```bash
pip install git+https://github.com/ysidromdenis/template-sync-tabula-cloud.git
```

## ‚ú® Caracter√≠sticas Principales

- **Ejecutable Standalone**: No requiere Python instalado
- **Core Robusto**: Funcionalidades b√°sicas de sesi√≥n, URLs y constantes
- **Modelos de Datos**: Estructuras para documentos de Tabula Cloud
- **Utilidades Avanzadas**: Logging, configuraci√≥n y helpers
- **Servicio Multiplataforma**: Windows Service / systemd / launchd
- **Sincronizaci√≥n Autom√°tica**: Daemon configurable con intervalos
- **Autenticaci√≥n Segura**: Tokens y credenciales encriptadas
- **CLI Completa**: Interfaz de l√≠nea de comandos para gesti√≥n
- **Logging Avanzado**: Rotaci√≥n autom√°tica y niveles configurables
- **Recuperaci√≥n de Errores**: Reintentos autom√°ticos y alertas

## üéØ Gesti√≥n del Servicio

### Comandos B√°sicos

```bash
# Instalar como servicio del sistema
sudo tabula-cloud-sync install --config /path/to/config.ini

# Gestionar servicio
sudo tabula-cloud-sync start      # Iniciar
sudo tabula-cloud-sync stop       # Detener
sudo tabula-cloud-sync restart    # Reiniciar
sudo tabula-cloud-sync status     # Ver estado
sudo tabula-cloud-sync remove     # Desinstalar

# Ejecutar en primer plano (debug)
tabula-cloud-sync --foreground --config config.ini
```

### Ubicaciones de Configuraci√≥n

```bash
# Linux
/etc/tabula-cloud-sync/config.ini
# o archivo local: ./config.ini

# Windows
%PROGRAMDATA%\TabulaCloudSync\config.ini
# o archivo local: .\config.ini

# macOS
/usr/local/etc/tabula-cloud-sync/config.ini
# o archivo local: ./config.ini
```

### Logs

```bash
# Linux (systemd)
sudo journalctl -u tabula-cloud-sync -f

# Linux (archivos)
tail -f /var/log/tabula-cloud-sync/service.log

# Windows
# Ver en: %PROGRAMDATA%\TabulaCloudSync\logs\

# macOS
tail -f /usr/local/var/log/tabula-cloud-sync/service.log
```

## üîß Configuraci√≥n

### Archivo de Configuraci√≥n (config.ini)

```ini
[mysql]
host = tu_host
user = tu_usuario
password = tu_password
database = tu_database
port = 3306

[sincronizador]
token = tu_token_de_api
interval = 30  # segundos entre sincronizaciones
url = tu_dominio.tabula.com.py

[servicio]
log_level = INFO
log_file = tabula_service.log
max_retries = 3
timeout = 30
```

### Plantilla Base

El proyecto incluye `config.ini.template` con todos los par√°metros disponibles. Simplemente c√≥pialo y personal√≠zalo:

```bash
cp config.ini.template config.ini
```

## üíª Uso Program√°tico

### Como Biblioteca en tu Proyecto

```python
from tabula_cloud_sync.core import session, urls, consts
from tabula_cloud_sync.models import documentos
from tabula_cloud_sync.utils import commons, logger
from tabula_cloud_sync.service import TabulaCloudService

# Implementar tu servicio personalizado
class MiProyectoService(TabulaCloudService):
    def perform_sync(self):
        """Tu l√≥gica de sincronizaci√≥n personalizada"""
        self.logger.info("Ejecutando sincronizaci√≥n...")

        # Usar self.session para API calls
        response = self.session.get("api/documents/v1/documentos/")

        if response.status_code == 200:
            documents = response.json()
            # Procesar documentos...
            self.logger.info(f"Procesados {len(documents)} documentos")

# Inicializar y usar
service = MiProyectoService("config.ini")
service.start_service()
```

### Como Script Standalone

```python
#!/usr/bin/env python3
import time
from tabula_cloud_sync import TabulaCloudService

def main():
    # Crear instancia del servicio
    service = TabulaCloudService("config.ini")

    try:
        while True:
            # Ejecutar sincronizaci√≥n
            service.perform_sync()

            # Esperar intervalo configurado
            time.sleep(service.config.getint('sincronizador', 'interval'))

    except KeyboardInterrupt:
        print("Servicio detenido por el usuario")
        service.stop_service()

if __name__ == "__main__":
    main()
```

## üèóÔ∏è Desarrollo

### Configuraci√≥n del Entorno de Desarrollo

```bash
# Clonar el repositorio
git clone https://github.com/ysidromdenis/template-sync-tabula-cloud.git
cd template-sync-tabula-cloud

# Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Linux/macOS
# o
venv\Scripts\activate     # Windows

# Instalar en modo desarrollo
pip install -e .
pip install -e .[dev]  # Incluye dependencias de desarrollo

# Ejecutar tests
pytest tests/ -v

# Formatear c√≥digo
black .
isort .

# Verificar linting
flake8 .
```

### Tests y Calidad de C√≥digo

```bash
# Ejecutar todos los tests
pytest tests/ -v --cov=.

# Tests espec√≠ficos
pytest tests/test_service.py -v

# Verificar cobertura
pytest --cov=. --cov-report=html
```

## üì¶ Compilaci√≥n a Ejecutable

### Compilaci√≥n Local

```bash
# M√©todo 1: Script autom√°tico (recomendado)
python build_executable.py

# M√©todo 2: Makefile
make compile

# M√©todo 3: Con verificaci√≥n previa
python test_compilation.py  # Verificar dependencias
python build_executable.py  # Compilar
```

### Distribuci√≥n

Los ejecutables compilados **no requieren Python** instalado:

```bash
# Windows
tabula-cloud-sync.exe install --config config.ini
tabula-cloud-sync.exe --foreground

# Linux/macOS
./tabula-cloud-sync install --config config.ini
./tabula-cloud-sync --foreground
```

## üöÄ CI/CD y Releases

### Workflows Automatizados

Este proyecto usa **GitHub Actions** con separaci√≥n de responsabilidades:

#### 1. **Tests Continuos** (`.github/workflows/test.yml`)

- **Trigger**: Push/PR a `main` y `develop`
- **Matriz**: Ubuntu, Windows, macOS √ó Python 3.9, 3.10, 3.11
- **Duraci√≥n**: ~5-8 minutos
- **Prop√≥sito**: Validaci√≥n r√°pida durante desarrollo

#### 2. **Build y Release** (`.github/workflows/build.yml`)

- **Trigger**: Solo tags `v*` (ej: `v1.0.0`)
- **Salida**: Ejecutables para las 3 plataformas + GitHub Release
- **Duraci√≥n**: ~15-20 minutos
- **Prop√≥sito**: Release de producci√≥n con ejecutables

### Estrategia de Releases Automatizada

| Tipo           | Patr√≥n       | Descripci√≥n       | Ejemplo          |
| -------------- | ------------ | ----------------- | ---------------- |
| üü¢ **Estable** | `v*`         | Producci√≥n        | `v1.0.0`         |
| üü° **Beta**    | `v*-beta.*`  | Pre-release       | `v1.1.0-beta.1`  |
| üü† **Alpha**   | `v*-alpha.*` | Experimental      | `v2.0.0-alpha.1` |
| üîµ **RC**      | `v*-rc.*`    | Release candidate | `v1.0.0-rc.1`    |

### Crear una Release

#### M√©todo 1: Script Helper (Recomendado)

```bash
# Release estable
./scripts/create-release.sh stable 1.0.0

# Pre-release
./scripts/create-release.sh beta 1.1.0-beta.1

# Release de desarrollo
./scripts/create-release.sh alpha 1.2.0-alpha.1
```

#### M√©todo 2: Manual

```bash
# Crear y pushear tag
git tag v1.0.0
git push origin v1.0.0
```

#### M√©todo 3: GitHub Web

1. Ve a tu repositorio ‚Üí "Releases"
2. Click "Create a new release"
3. Escribir tag: `v1.0.0`
4. GitHub Actions compilar√° autom√°ticamente

### Qu√© Incluye una Release

Cada release autom√°ticamente genera:

- **Ejecutables compilados** para Windows, Linux, macOS
- **Packages completos** con documentaci√≥n esencial (`INSTALL.md`)
- **Checksums SHA256** para verificaci√≥n de integridad
- **Release notes** autom√°ticas con cambios
- **Detecci√≥n autom√°tica** de pre-releases (alpha/beta/rc)

### Verificaci√≥n de Integridad

```bash
# Descargar checksums
wget https://github.com/ysidromdenis/template-sync-tabula-cloud/releases/download/v1.0.0/checksums.txt

# Verificar archivos descargados
sha256sum -c checksums.txt
```

## üê≥ Docker

### Docker Compose (Recomendado)

```bash
# Crear directorios
mkdir -p config logs data

# Copiar template de configuraci√≥n
cp config.ini.template config/config.ini
nano config/config.ini  # Editar configuraci√≥n

# Iniciar servicio
docker-compose up -d

# Ver logs
docker-compose logs -f tabula-sync

# Detener
docker-compose down
```

### Docker Manual

```bash
# Construir imagen
docker build -t tabula-cloud-sync .

# Ejecutar contenedor
docker run -d \
  --name tabula-sync \
  -v $(pwd)/config:/etc/tabula \
  -v $(pwd)/logs:/var/log/tabula \
  tabula-cloud-sync
```

### Docker con GitHub Container Registry (Opcional)

Si necesitas publicar im√°genes Docker, puedes habilitar el workflow opcional:

```bash
# Renombrar el workflow de Docker
mv .github/workflows/docker-optional.yml .github/workflows/docker.yml

# Personalizar configuraci√≥n si es necesario
nano .github/workflows/docker.yml
```

## üìÅ Estructura del Proyecto

```
tabula-cloud-sync/
‚îú‚îÄ‚îÄ __init__.py                 # Punto de entrada principal
‚îú‚îÄ‚îÄ __main__.py                # CLI y ejecuci√≥n directa
‚îú‚îÄ‚îÄ build_executable.py        # Script de compilaci√≥n
‚îú‚îÄ‚îÄ setup.py                   # Configuraci√≥n de distribuci√≥n
‚îú‚îÄ‚îÄ requirements.txt           # Dependencias base
‚îú‚îÄ‚îÄ pyproject.toml            # Configuraci√≥n moderna de Python
‚îú‚îÄ‚îÄ config.ini.template       # Plantilla de configuraci√≥n
‚îú‚îÄ‚îÄ INSTALL.md                 # Gu√≠a de instalaci√≥n para usuarios finales
‚îú‚îÄ‚îÄ Makefile                  # Comandos de automatizaci√≥n
‚îú‚îÄ‚îÄ docker-compose.yml        # Configuraci√≥n de Docker
‚îÇ
‚îú‚îÄ‚îÄ core/                     # Funcionalidades b√°sicas
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ consts.py            # Constantes globales
‚îÇ   ‚îú‚îÄ‚îÄ session.py           # Gesti√≥n de sesiones HTTP
‚îÇ   ‚îî‚îÄ‚îÄ urls.py              # URLs y endpoints
‚îÇ
‚îú‚îÄ‚îÄ models/                   # Modelos de datos
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ documentos.py        # Modelos para documentos
‚îÇ
‚îú‚îÄ‚îÄ utils/                    # Utilidades comunes
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ commons.py           # Funciones auxiliares
‚îÇ   ‚îî‚îÄ‚îÄ logger.py            # Sistema de logging
‚îÇ
‚îú‚îÄ‚îÄ service/                  # Servicio multiplataforma
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base_service.py      # Clase base del servicio
‚îÇ   ‚îú‚îÄ‚îÄ daemon.py            # Daemon para Linux/Unix
‚îÇ   ‚îú‚îÄ‚îÄ windows_service.py   # Servicio para Windows
‚îÇ   ‚îî‚îÄ‚îÄ manager.py           # Administrador del servicio
‚îÇ
‚îú‚îÄ‚îÄ .github/workflows/        # CI/CD con GitHub Actions
‚îÇ   ‚îú‚îÄ‚îÄ test.yml             # Tests continuos
‚îÇ   ‚îú‚îÄ‚îÄ build.yml            # Build y release
‚îÇ   ‚îî‚îÄ‚îÄ docker-optional.yml  # Docker (opcional)
‚îÇ
‚îú‚îÄ‚îÄ docs/                     # Documentaci√≥n t√©cnica
‚îÇ   ‚îú‚îÄ‚îÄ GITHUB_RELEASES.md   # Gu√≠a de releases
‚îÇ   ‚îú‚îÄ‚îÄ GITHUB_ACTIONS.md    # Documentaci√≥n de CI/CD
‚îÇ   ‚îú‚îÄ‚îÄ COMPILATION.md       # Gu√≠a de compilaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ CONFIGURATION.md     # Configuraci√≥n detallada
‚îÇ   ‚îî‚îÄ‚îÄ SERVICE_CONFIGURATION.md  # Configuraci√≥n del servicio
‚îÇ
‚îú‚îÄ‚îÄ examples/                 # Ejemplos de uso
‚îÇ   ‚îú‚îÄ‚îÄ example_service.py   # Servicio de ejemplo
‚îÇ   ‚îî‚îÄ‚îÄ mi_proyecto_ejemplo/  # Proyecto completo de ejemplo
‚îÇ
‚îú‚îÄ‚îÄ scripts/                  # Scripts de utilidad
‚îÇ   ‚îî‚îÄ‚îÄ create-release.sh    # Script para crear releases
‚îÇ
‚îú‚îÄ‚îÄ tests/                    # Tests unitarios
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ test_service.py
‚îÇ
‚îú‚îÄ‚îÄ docker/                   # Configuraci√≥n de Docker
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ entrypoint.sh
‚îÇ
‚îî‚îÄ‚îÄ icons/                    # Recursos gr√°ficos
    ‚îî‚îÄ‚îÄ tabula.ico
```

## üìö Documentaci√≥n Adicional

- **[üìñ Gu√≠a de Instalaci√≥n](INSTALL.md)** - Instalaci√≥n simple para usuarios finales
- **[üè∑Ô∏è GitHub Releases](docs/GITHUB_RELEASES.md)** - Versionado y distribuci√≥n
- **[üèóÔ∏è GitHub Actions](docs/GITHUB_ACTIONS.md)** - Workflows y automatizaci√≥n
- **[‚öôÔ∏è Configuraci√≥n del Servicio](docs/SERVICE_CONFIGURATION.md)** - Gu√≠a completa del servicio
- **[üîß Configuraci√≥n General](docs/CONFIGURATION.md)** - Configuraci√≥n b√°sica
- **[üì¶ Compilaci√≥n](docs/COMPILATION.md)** - Compilaci√≥n a ejecutables
- **[üìã Ejemplos](examples/)** - Ejemplos pr√°cticos de implementaci√≥n

## ü§ù Contribuir

### Flujo de Desarrollo

1. Fork el proyecto
2. Crear una rama feature (`git checkout -b feature/nueva-caracteristica`)
3. Commit cambios (`git commit -am 'Agregar nueva caracter√≠stica'`)
4. Push a la rama (`git push origin feature/nueva-caracteristica`)
5. Crear Pull Request

### Guidelines

- Seguir [PEP 8](https://pep8.org/) para estilo de c√≥digo
- Incluir tests para nuevas funcionalidades
- Documentar cambios en el CHANGELOG.md
- Usar commits descriptivos en espa√±ol

### Desarrollo Local

```bash
# Configurar hooks de pre-commit
pip install pre-commit
pre-commit install

# Ejecutar verificaciones
pre-commit run --all-files
```

## üìÑ Licencia

Este proyecto est√° bajo la licencia [MIT](LICENSE). Ver el archivo LICENSE para m√°s detalles.

## üÜò Soporte

- **Issues**: [GitHub Issues](https://github.com/ysidromdenis/template-sync-tabula-cloud/issues)
- **Releases**: [GitHub Releases](https://github.com/ysidromdenis/template-sync-tabula-cloud/releases)
- **Documentaci√≥n**: [docs/](docs/)

---

**Desarrollado con ‚ù§Ô∏è para la comunidad Tabula Cloud**
